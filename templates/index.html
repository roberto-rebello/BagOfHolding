{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block body %}

<div class="sidenav">
    <div class="row center">
        <img src="../static/img/bag.webp" class="avatar">
    </div>
    <div class="row start">
        <a href="/"><b>Bag</b></a>
    </div>
</div>

<div class="content">
    <div class="navbar row">
        <div class="col-2">
        </div>
        <div class="col-6 center">
            <h1>Bag Of Holding</h1>
        </div>
        <div class="col-2 end">
            <form action="/logout" >
                <button type="submit" name="logout">Log Out</button>
            </form>
        </div>
    </div>

    {% if items|length < 1 %}
    <h4>Such Empty...</h4>
    <img src="{{ url_for('static', filename='img/tumbleweed.gif') }}" alt="Tumbleweed">
    {% else %}
    <table class="noHover">
        <tr>
            <th>
                Party Gold
                <a href="/update/coin"><i class='far fa-edit'></i></a>
            </th>
            <th>Items Value</th>
            <th>Items Weight</th>
        </tr>
        <tr>
            <td>{{ party_gold }} g</td>
            <td>{{ items_value }} g</td>
            <td>{{ items_weight }} lb</td>
        </tr>
    </table>
    <br>
    <div class="row">
        <div class="col-1 center">
            <form action="/create" >
                <button type="submit" name="create">Add Item</button>
            </form>
        </div>
        <div class="col-9 end">
            <span class="search fas fa-search"></span>
            <input class="search" type="text" id="searchItem" onkeyup="searchItem()" onfocusout="checkFocus()">
        </div>
    </div>
    <br>
    <table id="itemTable">
        <tr class="noHover">
            <th>Name</th>
            <th>Description</th>
            <th>Location</th>
            <th>Price</th>
            <th>Weight</th>
            <th>Quantity</th>
            <th>Type</th>
            <th>Magic Item</th>
            <th>Actions</th>
        </tr>
        {% for item in items %}
        <tr id="item_{{item._id}}">
            {% if item._href == "" %}
            <td>{{ item._name}}</td>
            {% else %}
            <td><a href="{{ item._href }}" target="_blank" rel="external noreferrer nofollow noopener">{{ item._name}}</a></td>
            {% endif %}
            <td>{{ item._description }}</td>
            <td>{{ item._location }}</td>
            <td>{{ item._price }}</td>
            <td>{{ item._weight }}</td>
            <td>
                <div class="row">
                    <div class="col-5 center">
                        {{ item._quantity }}
                    </div>
                    <div class="col-5">
                        <div class="col-5 center">
                            <a href="/add/{{item._id}}"><i class='fas fa-plus' style='font-size:12px'></i></a>
                        </div>
                        <div class="col-5 center">
                            <a href="/subtract/{{item._id}}"><i class='fas fa-minus' style='font-size:12px'></i></a>
                        </div>
                    </div>
                </div>
            </td>
            <td>{{ item._type }}</td>
            <td>{{ item._isMagic }}</td>
            <td>
                <a href="/update/{{item._id}}"><i class='far fa-edit'></i></a>
                <a href="/copy/{{item._id}}"><i class='far fa-copy'></i></a>
                <a href="/delete/{{item._id}}"><i class='fa fa-trash'></i></a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <script>
        function searchItem() {
          var filter = document.getElementById("searchItem").value.toUpperCase();
          var items = document.getElementById("itemTable").getElementsByTagName("tr");

          // Loop through all items, hide those that don't match the search query
          for (var i = 1; i < items.length; i++) { // Skip header

                var name = items[i].getElementsByTagName("td")[0]; // item name field
                var nameValue = name.textContent || name.innerText;

                var location = items[i].getElementsByTagName("td")[2]; // item location field
                var locationValue = location.textContent || location.innerText;

                var type = items[i].getElementsByTagName("td")[6]; // item type field
                var typeValue = type.textContent || type.innerText;

                if (nameValue.toUpperCase().indexOf(filter) > -1 ||
                    typeValue.toUpperCase().indexOf(filter) > -1 ||
                    locationValue.toUpperCase().indexOf(filter) > -1) {

                  items[i].style.display = "";

                } else {

                  items[i].style.display = "none";

                }
            }
        }

        function checkFocus() {
            var element = document.getElementById("searchItem");
            var empty = (element.value == "")
            element.classList.toggle("notEmpty", !empty)
        }
    </script>
    {% endif %}
</div>
{% endblock %}
